<app-header backButton="/auth" title="Login"></app-header>

<ion-content>
  <h2 class="textwhite registertitle">Registro</h2>
  <div class="d-flex-center">
    <form
      [formGroup]="form"
      class="auth-form"
      (ngSubmit)="submit()"
      (keypress.enter)="submit()"
    >
      <div class="step-indicator">
        <div [class.active]="currentStep === 1"></div>
        <div [class.active]="currentStep === 2"></div>
      </div>

      <h2><strong class="textwhite">{{ currentStep }}/2</strong></h2>

      <!-- <app-logo></app-logo> -->
      <ng-container *ngIf="currentStep === 1">
        <app-custom-input
          autoComplete="name"
          icon="person-outline"
          [control]="form.controls.name"
          type="text"
          label="Nombre"
          (blur)="form.controls.name.markAsTouched()"
        ></app-custom-input>
        <div
          class="validators"
          *ngIf="form.controls.name.errors && form.controls.name.touched"
        >
          <div *ngIf="form.controls.name.errors?.['required']">
            El nombre es requerido
          </div>
          <div *ngIf="form.controls.name.errors?.['minlength']">
            El nombre debe tener al menos 4 caracteres
          </div>
        </div>

        <app-custom-input
          autoComplete="surname"
          icon="person-outline"
          [control]="form.controls.surname"
          type="text"
          label="Apellido"
          (blur)="form.controls.name.markAsTouched()"
        ></app-custom-input>
        <div
          class="validators"
          *ngIf="form.controls.surname.errors && form.controls.surname.touched"
        >
          <div *ngIf="form.controls.surname.errors?.['required']">
            El nombre es requerido
          </div>
          <div *ngIf="form.controls.surname.errors?.['minlength']">
            El nombre debe tener al menos 4 caracteres
          </div>
        </div>

        <app-custom-input
          autoComplete="dateBirth"
          icon="person-outline"
          [control]="form.controls.dateBirth"
          type="date"
          label="Fecha de nacimiento"
          (blur)="form.controls.dateBirth.markAsTouched()"
        ></app-custom-input>
        <div
          class="validators"
          *ngIf="form.controls.dateBirth.errors && form.controls.dateBirth.touched"
        >
          <div *ngIf="form.controls.dateBirth.errors?.['required']">
            Fecha de nacimiento es requerido
          </div>
        </div>

        <app-custom-input
          autoComplete="dni"
          icon="id-card-outline"
          [control]="form.controls.dni"
          type="text"
          label="DNI"
          inputmode="numeric"
          (blur)="form.controls.dni.markAsTouched()"
          maxlength="11"
        ></app-custom-input>
        <div
          class="validators"
          *ngIf="form.controls.dni.errors && form.controls.dni.touched"
        >
          <div *ngIf="form.controls.dni.errors?.['required']">
            El DNI es requerido
          </div>
          <div *ngIf="form.controls.dni.errors?.['minlength']">
            Mínimo 7 caracteres
          </div>
          <div *ngIf="form.controls.dni.errors?.['maxlength']">
            Máximo 8 caracteres
          </div>
        </div>

        <app-custom-input
          autoComplete="email"
          icon="mail-outline"
          [control]="form.controls.email"
          type="email"
          label="Correo"
          (blur)="form.controls.email.markAsTouched()"
        ></app-custom-input>
        <div
          class="validators"
          *ngIf="form.controls.email.errors && form.controls.email.touched"
        >
          <div *ngIf="form.controls.email.errors?.['required']">
            El correo es requerido
          </div>
          <div *ngIf="form.controls.email.errors?.['email']">
            Ingrese un correo válido
          </div>
        </div>

        <app-custom-input
          icon="woman-outline"
          [control]="form.controls.gender"
          [isSelect]="true"
          label="Género"
          [options]="[
          { label: 'Masculino', value: 'masculino' },
          { label: 'Femenino', value: 'femenino' },
          { label: 'Otro', value: 'otro' }
        ]"
          (blur)="form.controls.gender.markAsTouched()"
        ></app-custom-input>
        <div
          class="validators"
          *ngIf="form.controls.gender.errors && form.controls.gender.touched"
        >
          <div *ngIf="form.controls.gender.errors?.['required']">
            El género es requerido
          </div>
        </div>

        <ion-button
          expand="block"
          mode="ios"
          class="submit enviar"
          (click)="nextStep()"
          [disabled]="!formStep1.valid"
        >
          Siguiente
        </ion-button>
      </ng-container>

      <ng-container *ngIf="currentStep === 2">
        <app-custom-input
          autoComplete="tel"
          icon="call-outline"
          [control]="form.controls.telephone"
          type="tel"
          label="Teléfono"
        ></app-custom-input>
        <div
          class="validators"
          *ngIf="form.controls.telephone.errors && form.controls.telephone.touched"
        >
          <div *ngIf="form.controls.telephone.errors?.['required']">
            El teléfono es requerido
          </div>
          <div *ngIf="form.controls.telephone.errors?.['minlength']">
            Debe tener al menos 6 caracteres
          </div>
        </div>

        <app-custom-input
          [control]="form.controls.province"
          [isSelect]="true"
          label="Provincia"
          icon="location-outline"
          [options]="provincias"
          placeholder="Seleccioná tu provincia"
          cancelText="Cerrar"
          cancelButtonIcon="close-outline"
          (blur)="form.controls.province.markAsTouched()"
        ></app-custom-input>
        <div
          class="validators"
          *ngIf="form.controls.province.errors && form.controls.province.touched"
        >
          <div *ngIf="form.controls.province.errors?.['required']">
            La provincia es requerida
          </div>
        </div>

        <app-custom-input
          icon="lock-closed-outline"
          [control]="form.controls.password"
          type="password"
          label="Contraseña"
          (blur)="form.controls.password.markAsTouched()"
        ></app-custom-input>
        <div
          class="validators"
          *ngIf="form.controls.password.errors && form.controls.password.touched"
        >
          <div *ngIf="form.controls.password.errors?.['required']">
            La contraseña es requerida
          </div>
        </div>
        <ion-item lines="none">
          <ion-label>¿Tiene convenio de empresa?</ion-label>
          <ion-toggle [formControl]="form.controls.tieneConvenio"></ion-toggle>
        </ion-item>

        <!-- Campo solo visible si tieneConvenio es true -->
        <ng-container *ngIf="form.controls.tieneConvenio.value">
          <app-custom-input
            icon="business"
            label="Código de empresa"
            [control]="form.controls.codigoEmpresa"
          ></app-custom-input>
        </ng-container>

        <ion-button
          expand="block"
          mode="ios"
          class="submit enviar"
          (click)="prevStep()"
          [disabled]="!formStep1.valid"
        >
          Anterior
        </ion-button>

        <ion-button
          expand="block"
          mode="ios"
          class="submit enviar"
          type="submit"
          [disabled]="form.invalid"
        >
          Registrarse
          <ion-icon slot="start" name="person-add-outline"></ion-icon>
        </ion-button>
      </ng-container>
    </form>
  </div>
</ion-content>
